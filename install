#!/bin/bash

set -e

backup() {
    local dotfile="$1"
    if [ -f "$HOME/.$dotfile" ]; then
        mv "$HOME/.$dotfile" "$HOME/dot.$dotfile.bak"
        echo "Backed up $HOME/.$dotfile as $HOME/dot.$dotfile.bak"
    fi
}

backup "bash_profile"
backup "profile"
backup "bash_login"
backup "bashrc"

ln -nfs $(pwd)/dot.bash_functions.sh "$HOME/.bash_functions"
ln -nfs $(pwd)/dot.bash_login.sh "$HOME/.bash_login"
ln -nfs $(pwd)/dot.bashrc.sh "$HOME/.bashrc"
ln -nfs $(pwd)/dot.colordiffrc "$HOME/.colordiffrc"
ln -nfs $(pwd)/dot.gemrc "$HOME/.gemrc"
ln -nfs $(pwd)/dot.gitconfig "$HOME/.gitconfig"
ln -nfs $(pwd)/dot.vimrc "$HOME/.vimrc"

mkdir -p ~/.local/bin
ln -nfs $(pwd)/lessfilter-highlight.sh ~/.local/bin/lessfilter-highlight

if [ "$(uname)" = 'Darwin' ]; then
    sed "s#\${HOME}#$HOME#g" < $(pwd)/environment.plist.in > ~/Library/LaunchAgents/environment.plist
    ln -nfs $(pwd)/ssh-keychain.plist ~/Library/LaunchAgents/
    ln -nfs $(pwd)/library-path.plist ~/Library/LaunchAgents/
fi

mkdir -p ~/.vim/autoload ~/.vim/bundle
curl -LSso ~/.vim/autoload/pathogen.vim https://tpo.pe/pathogen.vim

git clone git://github.com/tpope/vim-sensible.git ~/.vim/bundle/vim-sensible

