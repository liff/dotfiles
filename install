#!/bin/bash

shopt -s extglob # for proper_dot_filename

collect_existing_files() {
    local result
    for f in "$@"; do
	[ -f $HOME/$f ] && result="$result $HOME/$f"
    done
    echo $result
}

proper_dot_filename() {
    local no_ext="${1%@(.rb|.sh)}"
    echo ${no_ext#dot}
}

BASIC_DOTFILES=$"dot.*.sh dot.*.rb dot.ackrc dot.colordiffrc dot.vimrc"

echo "About to overwrite following files:"
for src_dotfile in $BASIC_DOTFILES; do
    target_dotfile="$HOME/$(proper_dot_filename "$src_dotfile")"
    [ -f "$target_dotfile" ] && echo -e '\t' $target_dotfile
done

read -ep "Continue? " please_continue
if [ "$please_continue" != "y" ]; then
    echo "Aborted"
    exit 1
fi

for src_dotfile in $BASIC_DOTFILES; do
    target_dotfile="$HOME/$(proper_dot_filename "$src_dotfile")"
    echo "${src_dotfile} -> ${target_dotfile}"
    cp "$src_dotfile" "$target_dotfile"
done

maybe_remove=$(collect_existing_files .profile .bash_profile .emacs .emacs.el)
if [ "$maybe_remove" != "" ]; then
    echo "You may want to remove or rename the following files:"
    for f in $maybe_remove; do
	echo -e "\t$f"
    done
fi
